## Способы внешней авторизации

### OIDC

Для начала, необходимо реализовать протокол oidc по которому будет производиться получение данных пользователя для дальнейшей авторизации
Для работы по протоколу oidc необходимо предоставить следующие параметры:

authorizationURL: https://your-domain.com/authorize
tokenURL: https://your-domain.com/token
userInfoURL: https://your-domain.com/userinfo

Затем, необходимо зарегистрировать нового клиента и данные, необходимые для авторизации по протоколу oidc:
clientID: client-id-for-condo-app
clientSecret: client-secret-for-condo-app
callbackURL: https://condo.d.doma.ai/api/auth/your-domain/callback
scope: openid phone email

Мы ожидаем, что профиль пользователя будет содержать следующие параметры:
sub: Уникальный идентификатор пользователя в вашей системе
name: Имя пользователя
phone: Номер телефона пользователя
phone_verified: Подтвержден ли телефон у пользователя
email: Почта пользователя
email_verified: Подтверждена ли почта у пользователя

Обязательные поля в профиле пользователя: sub, phone

После настройки протокола, для авторизации пользователя необходимо выполнить GET запрос по адресу https://condo.d.doma.ai/api/auth/your-domain?userType=resident

Обязательным параметром в данном запросе является тип пользователя, который должен быть создан и авторизован в нашей системе.
Возможные типы пользователей - resident (житель) и staff (сотрудник)

При отправке запроса по этому адресу сервис совершит авторизацию по протоколу oidc с вашим сервером, получит данные пользователя, зарегистрирует его и вернет токен доступа и информацию о нем в следующем формате:

```
{
    expiresIn: <expire_seconds:int>,
    scope: 'openid',
    tokenType: 'Bearer',
    accessToken: <token:str>
}
```

Далее для выполнения запросов в сервис необходимо подставить полученный токен в заголовок запроса Authorization:

```
{
    "Authorization": "Bearer accessToken"
}
```
